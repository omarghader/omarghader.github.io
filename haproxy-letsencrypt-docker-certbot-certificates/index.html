<!doctype html><html lang=en-us>
<head>
<meta http-equiv=content-type content="text/html" charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/omarghader.github.io\/"},"articleSection":"post","name":"HAProxy LetsEncrypt Docker Tutorial: Create and Renew HTTPs Certificates for free","headline":"HAProxy LetsEncrypt Docker Tutorial: Create and Renew HTTPs Certificates for free","description":" Use certbot to create free letsencrypt HTTPS certificates for HAPROXY docker and renew it automatically ","inLanguage":"en-US","author":"Omar Ghader","creator":"Omar Ghader","publisher":"Omar Ghader","accountablePerson":"map[]","copyrightHolder":"map[]","copyrightYear":"2020","datePublished":"2020-10-22T17:57:23+02:00","dateModified":"2020-10-22T17:57:23+02:00","url":"https:\/\/omarghader.github.io\/haproxy-letsencrypt-docker-certbot-certificates\/","wordCount":"1222","image":"https:\/\/omarghader.github.io\//img/logo.png","keywords":["haproxy","docker","letsencrypt","certificate","https certificate","haproxy letsencrypt docker","certbot","nginx","haproxy","docker","letsencrypt","certificate","https certificate","haproxy letsencrypt docker","certbot","nginx","Blog"]}</script>
<title>HAProxy LetsEncrypt Docker Tutorial: Create and Renew HTTPs Certificates for free &#183; </title>
<meta name=HandheldFriendly content="True">
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel="shortcut icon" href=https://omarghader.github.io/favicon.ico>
<link rel=canonical href=https://omarghader.github.io/haproxy-letsencrypt-docker-certbot-certificates/>
<meta name=description content="Use certbot to create free letsencrypt HTTPS certificates for HAPROXY docker and renew it automatically">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="HAProxy LetsEncrypt Docker Tutorial: Create and Renew HTTPs Certificates for free">
<meta name=twitter:description content="Use certbot to create free letsencrypt HTTPS certificates for HAPROXY docker and renew it automatically">
<meta name=twitter:url content="https://omarghader.github.io/haproxy-letsencrypt-docker-certbot-certificates/">
<meta name=twitter:site content="@">
<meta property="og:site_name" content>
<meta property="og:title" content="HAProxy LetsEncrypt Docker Tutorial: Create and Renew HTTPs Certificates for free &#183; Omar Ghaders Blog">
<meta property="og:url" content="https://omarghader.github.io/haproxy-letsencrypt-docker-certbot-certificates/">
<meta property="og:type" content="article">
<meta property="og:description" content="Use certbot to create free letsencrypt HTTPS certificates for HAPROXY docker and renew it automatically">
<meta property="article:published_time" content="2020-10-22T17:57:23+02:00">
<meta property="article:tag" content="haproxy"><meta property="article:tag" content="docker"><meta property="article:tag" content="letsencrypt"><meta property="article:tag" content="certificate"><meta property="article:tag" content="https certificate"><meta property="article:tag" content="haproxy letsencrypt docker"><meta property="article:tag" content="certbot"><meta property="article:tag" content="nginx">
<meta property="og:image" content="https://omarghader.github.io/img/blog-cover.jpg">
<meta name=generator content="Hugo 0.92.2">
<link rel=stylesheet type=text/css href=https://omarghader.github.io/built/screen.css>
<link rel=stylesheet type=text/css href=https://omarghader.github.io/css/casper-two.css>
<link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css>
<link rel=stylesheet href=https://omarghader.github.io/css/custom.css>
</head>
<body class=post-template>
<div class=site-wrapper>
<header class="site-header outer">
<div class=inner>
<nav class=site-nav>
<div class=site-nav-left>
<a class=site-nav-logo href=#><img src=https://omarghader.github.io/img/logo.png alt="Omar Ghaders Blog"></a>
<ul class=nav role=menu>
<li role=menuitem>
<a href=https://omarghader.github.io/>Home</a>
</li>
<li role=menuitem>
<a href=https://omarghader.github.io/post>Posts</a>
</li>
<li role=menuitem>
<a href=https://omarghader.github.io/about>About</a>
</li>
</ul></div>
<div class=site-nav-right>
<div class=social-links>
<a class=social-link href=https://github.com/omarghader target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
</div>
</div>
</nav>
</div>
</header>
<main id=site-main class="site-main outer" role=main>
<div class=inner>
<article class="post-full post">
<header class=post-full-header>
<section class=post-full-meta>
<time class=post-full-meta-date datetime=2020-10-22>22 October 2020</time>
<span class=date-divider>/</span> <a href=https://omarghader.github.io/tags/haproxy/>#haproxy</a>&nbsp;<a href=https://omarghader.github.io/tags/docker/>#docker</a>&nbsp;
</section>
<h1 class=post-full-title>HAProxy LetsEncrypt Docker Tutorial: Create and Renew HTTPs Certificates for free</h1>
</header>
<figure class=post-full-image style=background-image:url(https://omarghader.github.io/defimg/6.jpg)>
</figure>
<section class=post-full-content>
<div class=kg-card-markdown>
<p>If you are looking to secure your website/API for free and found yourself on this page, that means you are on the good path :)
Securing pages are required for security reasons, but also improve your ranking on search engines and can impact your social visibility.</p>
<p>This tutorial will show how to secure a golang API using HAProxy and letsencrypt.</p>
<h2 id=whats-letsencrypt>What&rsquo;s LetsEncrypt</h2>
<p><a href=https://letsencrypt.org>LetsEncrypt</a> is a free certificate authority launched on 2016. It automates the delivery of certificates used to secure the traffic. The certificate is valid for 90 days.
The protocol ACME (Automated Certificate Management Environment) is used by LetsEncrypt to proof that you are the domain owner, to generate the certificate and to renew it.</p>
<h2 id=my-simple-application>My Simple Application</h2>
<p>For demo, I will create a simple golang hello world API REST running on the port 5000. You can create your own server with your favorite language.</p>
<p>Run the app using the command <code>go run main.go</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span>(
	<span style=color:#e6db74>&#34;fmt&#34;</span>
	<span style=color:#e6db74>&#34;net/http&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>){
      <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Hello World&#34;</span>)
    })
    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:5000&#34;</span>, <span style=color:#66d9ef>nil</span>)
}
</code></pre></div><h2 id=requirement>Requirement</h2>
<p>For this tutorial, you need a linux machine with an external IP address/FDQN.
I am using Linode server because it is very performant and affordable.</p>
<p>You can click on <a href=https://linode.gvw92c.net/c/2688530/939219/10906>this link</a> or on the image below to get <code>100$ free credit</code>.
<a href=https://linode.gvw92c.net/c/2688530/939219/10906 target=_top id=939219>
<img src=https://omarghader.github.io/img/linode.jpg border=0 alt width=728 height=90>
</a></p>
<h2 id=haproxy-configuration>HAProxy configuration</h2>
<p>Now that we have a running application, let&rsquo;s define the configuration of HAProxy that redirect the traffic to the application. Also, HAproxy should handle HTTPs requests and redirect all HTTP traffic to HTTPS.</p>
<pre tabindex=0><code>myproject
|--haproxy
    |-- haproxy.cfg
</code></pre><p><strong>On your root project folder, create a folder called haproxy</strong>. Add the file <code>haproxy.cfg</code> to the folder haproxy.</p>
<pre tabindex=0><code>global
  log stdout format raw local0
  daemon

  # Default ciphers to use on SSL-enabled listening sockets.
  # For more information, see ciphers(1SSL).
  ssl-default-bind-ciphers kEECDH+aRSA+AES:kRSA+AES:+AES256:RC4-SHA:!kEDH:!LOW:!EXP:!MD5:!aNULL:!eNULL

resolvers docker_resolver
    nameserver dns 127.0.0.11:53

defaults
  log     global
  mode    http
  option  httplog
  option  dontlognull

frontend http
    bind *:80
    mode http
	
	# if this is an ACME request to proof the domain ownder, then redirect to nginx-certbot server
    acl is_well_known path_beg -i /.well-known/
	
	# else redirect the traffic to https
    redirect scheme https code 301 if !is_well_known !{ ssl_fc }
    use_backend letsencrypt if is_well_known

backend letsencrypt
    server letsencrypt nginx-certbot:80 resolvers docker_resolver check init-addr none

frontend https
    bind *:443 ssl crt /usr/local/etc/certs/
    http-response set-header Strict-Transport-Security &quot;max-age=16000000; includeSubDomains; preload;&quot;
    default_backend mybackend

backend mybackend
    server backend1 172.17.0.1:5000 
    http-request add-header X-Forwarded-Proto https if { ssl_fc }

</code></pre><p>The above configuration will:</p>
<ul>
<li>Redirects HTTP to HTTPS then redirect to our application by default</li>
<li>Handle letsencrypt HTTP requests for verifying the domain owner. These requests starts by /.well-known/ always and target a specific file that should be served in HTTP. That&rsquo;s why we will use nginx to serve the target folder.</li>
<li>HTTPS requests will be secured using the certificates in /usr/local/etc/certs/. <strong>At least one certificate should be present. This is why it is important to create a dummy certificate before running haproxy</strong>. Otherwise, if the folder /usr/local/etc/certs/ is empty, the haproxy will show errors in log.</li>
</ul>
<h2 id=create-a-dummy-certificate>Create a dummy certificate</h2>
<p>Create the folder <code>certs</code> at the root of your project.</p>
<pre tabindex=0><code>myproject
|--certs
...
</code></pre><p>Create a self signed certificate using openssl.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install openssl 
$ openssl req -nodes -x509 -newkey rsa:2048 -keyout test.key -out test.crt -days <span style=color:#ae81ff>30</span>
$ cat test.key test.crt &gt; ./certs/test.pem
</code></pre></div><blockquote>
<p>If you like this tutorial, please give me support by subscribing to my Youtube channel <a href=https://www.youtube.com/channel/UCrBkxDt5fRLErQwhefINuaA>my youtube channel</a></p>
</blockquote>
<h2 id=run-haproxy>Run HAproxy</h2>
<p>Create the folder <code>webroot</code> at the root of your project. This is the folder where Letsencrypt will request the file to verify that you are the owner of the domain.</p>
<pre tabindex=0><code>myproject
|-- certs
|-- haproxy
|-- webroot
|-- docker-compose.yml
...
</code></pre><p>Now that the configurations and all the necessary folders are ready. Create the <code>docker-compose.yml</code> file on the root project directory.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.5&#34;</span>

<span style=color:#f92672>services</span>:
  <span style=color:#f92672>proxy</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>haproxy:latest</span>
    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
    <span style=color:#f92672>volumes</span>:
      - <span style=color:#ae81ff>./haproxy:/usr/local/etc/haproxy:ro</span>
      - <span style=color:#ae81ff>./certs:/usr/local/etc/certs:ro</span>
    <span style=color:#f92672>ports</span>:
      - <span style=color:#ae81ff>80</span>:<span style=color:#ae81ff>80</span>
      - <span style=color:#ae81ff>443</span>:<span style=color:#ae81ff>443</span>

  <span style=color:#f92672>nginx-certbot</span>:
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx</span>
    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>nginx-certbot</span>
    <span style=color:#f92672>volumes</span>:
      - <span style=color:#ae81ff>./webroot:/usr/share/nginx/html</span>
</code></pre></div><p>Run the haproxy and the nginx.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ docker-compose up -d
</code></pre></div><blockquote>
<p>If you are enjoying this tutorial, feel free to leave a comment. It means me a lot to know that you are appreciating my work :)</p>
</blockquote>
<h2 id=create-the-certificate-using-certbot>Create the certificate using certbot</h2>
<p>Certbot is the letsencrypt official tool for creating a signed certificate. A certificate is valid for 90 days only and should be renewed always. By default, a production certificate is delivered. Therefore, don&rsquo;t forget to use the option <code>--staging</code> for tests because Letsencrypt has rate limits.</p>
<blockquote>
<p>Attention: Letsencrypt it can generates only 5 certificates per week. Take a look at <a href=https://letsencrypt.org/docs/rate-limits/>their documentation</a></p>
</blockquote>
<p>Create the script <code>create-cert.sh</code> at your root project:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
set -e

echo <span style=color:#e6db74>&#34;Starting create new certificate...&#34;</span>
<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$#<span style=color:#e6db74>&#34;</span> -lt <span style=color:#ae81ff>2</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
    echo <span style=color:#e6db74>&#34;Usage: ...  &lt;domain&gt; &lt;email&gt; [options]&#34;</span>
    exit
<span style=color:#66d9ef>fi</span>

DOMAIN<span style=color:#f92672>=</span>$1
EMAIL<span style=color:#f92672>=</span>$2
OPTIONS<span style=color:#f92672>=</span>$3

docker run --rm <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -v $PWD/letsencrypt:/etc/letsencrypt <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -v $PWD/webroot:/webroot <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  certbot/certbot <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  certonly --webroot -w /webroot <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -d $DOMAIN <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --email $EMAIL <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --non-interactive <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  --agree-tos <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  $3

<span style=color:#75715e># Merge private key and full chain in one file and add them to haproxy certs folder</span>
<span style=color:#66d9ef>function</span> cat-cert<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
  dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;./letsencrypt/live/</span>$1<span style=color:#e6db74>&#34;</span>
  cat <span style=color:#e6db74>&#34;</span>$dir<span style=color:#e6db74>/privkey.pem&#34;</span> <span style=color:#e6db74>&#34;</span>$dir<span style=color:#e6db74>/fullchain.pem&#34;</span> &gt; <span style=color:#e6db74>&#34;./certs/</span>$1<span style=color:#e6db74>.pem&#34;</span>
<span style=color:#f92672>}</span>

<span style=color:#75715e># Run merge certificate for the requested domain name</span>
cat-cert $DOMAIN
</code></pre></div><p><strong>Explanation</strong> :</p>
<ul>
<li>This script will take 3 arguments : domain name, email and options.</li>
<li>Webroot option : tell the certbot to create the file for domain verification in the path /webroot</li>
<li>Options : this is very important to add any additional option for certbot, example: <code>--staging</code>.</li>
</ul>
<p>Run the script. Use &ndash;staging for test purposes. If your staging certificate is working, you can remove this option and create a production certificate later.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./create-cert yourdomain.com youremail.com  --staging
</code></pre></div><blockquote>
<p>If you have created successfully your certificate, don&rsquo;t forget to remove the dummy test certificate created <code>certs/test.pem</code>.</p>
</blockquote>
<h3 id=how-it-works>How it works:</h3>
<ul>
<li>The certbot command will create a verification file in webroot folder.</li>
<li>The letsencrypt service should be sent a request to the following url : <a href=http://yourdomainname.com/.well-known/random_verification_file_name>http://yourdomainname.com/.well-known/random_verification_file_name</a></li>
<li>The request will arrive to haproxy. It will redirect the request to nginx-certbot which serves the webroot folder.</li>
<li>If the verification file is found, the certificate will should created in <code>certs</code> folder</li>
</ul>
<h2 id=renew-certificate>Renew certificate</h2>
<p>Letsencrypt certificates are valid only for 90 days. Therefore, it should be renewed always. I have done a script to renews all my certificates each month.
Create this script at the project root folder and call it <code>renew-certs.sh</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
set -e

DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span> cd <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span> dirname <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BASH_SOURCE[0]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> &gt;/dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> pwd <span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
cd $DIR

echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date<span style=color:#66d9ef>)</span><span style=color:#e6db74> About to renew certificates&#34;</span> &gt;&gt; /var/log/letsencrypt-renew.log
/usr/bin/docker run <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>       -i <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>       --rm <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>       --name certbot <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>       -v $PWD/letsencrypt:/etc/letsencrypt <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>       -v $PWD/webroot:/webroot <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>       certbot/certbot <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>       renew -w /webroot

echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date<span style=color:#66d9ef>)</span><span style=color:#e6db74> Cat certificates&#34;</span> &gt;&gt; /var/log/letsencrypt-renew.log

<span style=color:#66d9ef>function</span> cat-cert<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
  dir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;./letsencrypt/live/</span>$1<span style=color:#e6db74>&#34;</span>
  cat <span style=color:#e6db74>&#34;</span>$dir<span style=color:#e6db74>/privkey.pem&#34;</span> <span style=color:#e6db74>&#34;</span>$dir<span style=color:#e6db74>/fullchain.pem&#34;</span> &gt; <span style=color:#e6db74>&#34;./certs/</span>$1<span style=color:#e6db74>.pem&#34;</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>for</span> dir in ./letsencrypt/live/*; <span style=color:#66d9ef>do</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$dir<span style=color:#e6db74>&#34;</span> !<span style=color:#f92672>=</span> *<span style=color:#e6db74>&#34;README&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
    cat-cert <span style=color:#66d9ef>$(</span>basename <span style=color:#e6db74>&#34;</span>$dir<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span>
  <span style=color:#66d9ef>fi</span>
<span style=color:#66d9ef>done</span>

echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date<span style=color:#66d9ef>)</span><span style=color:#e6db74> Reload haproxy&#34;</span> &gt;&gt; /var/log/letsencrypt-renew.log
docker service update --force proxy_proxy

echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date<span style=color:#66d9ef>)</span><span style=color:#e6db74> Done&#34;</span> &gt;&gt; /var/log/letsencrypt-renew.log
</code></pre></div><p>Create a crontask to run this renew script every month:</p>
<pre tabindex=0><code>$ echo &quot;0 0 1 * * your_project_path/renew-certs.sh&quot; &gt;&gt; /etc/crontab
</code></pre><h2 id=example-deploy-wordpress-with-free-ssl--certificate>Example: Deploy wordpress with free ssl certificate</h2>
<p>This is a full example on <a href=https://omarghader.github.io/wordpress-haproxy-letsencrypt-free-ssl/>how to deploy a wordpress + free ssl certificate</a>.</p>
<h2 id=conclustion>Conclustion</h2>
<p>There is many docker images that integrates the certbot mechanism. But I&rsquo;ve prefered to understand the mechanism and to do it by myself.</p>
<p>If you have any problem, feel free to write in a comment. I will reply you ASAP.</p>
</div>
<script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=auto data-full-width-responsive=true data-ad-client=ca-pub-2980078129213070 data-ad-slot=1658997746></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script>
</section>
<footer class=post-full-footer>
<section class=author-card>
<img class=author-profile-image src=https://omarghader.github.io/img/me/omar.jpg alt=Author>
<section class=author-card-content>
<h4 class=author-card-name><a href=https://omarghader.github.io/>Omar Ghader</a></h4>
<p>Fullstack web engineer and devops. Mobile web specialist</p>
</section>
</section>
</footer>
</article>
<div id=disqus_thread></div>
<script>var disqus_config=function(){this.page.url="https://omarghader.github.io/haproxy-letsencrypt-docker-certbot-certificates/",this.page.identifier="https://omarghader.github.io/haproxy-letsencrypt-docker-certbot-certificates/"};(function(){var a=document,b=a.createElement('script');b.src='https://omarghader.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
</div>
</main>
<aside class="read-next outer">
<div class=inner>
<div class=read-next-feed>
<article class=read-next-card style=background-image:url(https://omarghader.github.io/img/blog-cover.jpg)>
<header class=read-next-card-header>
<small class=read-next-card-header-sitetitle>&mdash; Omar Ghaders Blog &mdash;</small>
<h3 class=read-next-card-header-title><a href=https://omarghader.github.io/tags/haproxy/>#haproxy</a></h3>
</header>
<div class=read-next-divider><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
<div class=read-next-card-content>
<ul>
<li><a href=https://omarghader.github.io/my-first-post/>My First Post</a></li>
<li><a href=https://omarghader.github.io/how-to-turn-off-light-automatically/>How to turn off the light automatically when you go out using esp32</a></li>
<li><a href=https://omarghader.github.io/esp32-cam-tutorial/>ESP32 cam tutorial: Setup 5$ live streaming camera for you house with esphome</a></li>
<li><a href=https://omarghader.github.io/align-div-to-the-bottom-of-the-page-in-3-steps/>Align div to the bottom of the page in 3 steps</a></li>
</ul>
</div>
<footer class=read-next-card-footer>
<a href=https://omarghader.github.io/tags/haproxy/>See all related posts →</a>
</footer>
</article>
<article class="post-card post">
<a class=post-card-image-link href=https://omarghader.github.io/esp32-cam-tutorial/>
<div class=post-card-image style=background-image:url(https://omarghader.github.io/img/esp32cam.webp)></div>
</a>
<div class=post-card-content>
<a class=post-card-content-link href=https://omarghader.github.io/esp32-cam-tutorial/>
<header class=post-card-header>
<span class=post-card-tags>
#esphome
#esp32
#esp32 cam
#iot
#esp32 cam esphome
#esphome projects
#esp32 cam home assistant
#home assistant </span>
<h2 class=post-card-title>ESP32 cam tutorial: Setup 5$ live streaming camera for you house with esphome</h2>
</header>
<section class=post-card-excerpt>
<p>Setup and configure an esp32 cam with esphome to get a live streaming camera for your house for only 5$.</p>
</section>
</a>
<footer class=post-card-meta>
<img class=author-profile-image src=https://omarghader.github.io/img/me/omar.jpg alt=Author>
<span class=post-card-author><a href=https://omarghader.github.io/>Omar Ghader</a></span>
</footer>
</div>
</article>
<article class="post-card post">
<a class=post-card-image-link href=https://omarghader.github.io/how-to-connect-esp32-esphome-to-home-assistant/>
<div class=post-card-image style=background-image:url(https://omarghader.github.io/img/home_assistant_logo.svg)></div>
</a>
<div class=post-card-content>
<a class=post-card-content-link href=https://omarghader.github.io/how-to-connect-esp32-esphome-to-home-assistant/>
<header class=post-card-header>
<span class=post-card-tags>
#esphome
#esp32
#xiaomi mijia
#iot
#esp32 esphome
#esphome projects
#esp32 xiaomi
#esp32 home assistant
#home assistant
#ble
#esp32 home asistant
#esphome home assistant configuration
#home assistant docker
#hass </span>
<h2 class=post-card-title>How to connect ESP32 to home assistant in 5 minutes</h2>
</header>
<section class=post-card-excerpt>
<p>a tutorial to connect esp32 esphome to home assistant using esphome and create an automation example when temperature is low than 21 degrees</p>
</section>
</a>
<footer class=post-card-meta>
<img class=author-profile-image src=https://omarghader.github.io/img/me/omar.jpg alt=Author>
<span class=post-card-author><a href=https://omarghader.github.io/>Omar Ghader</a></span>
</footer>
</div>
</article>
</div>
</div>
</aside>
<div class=floating-header>
<div class=floating-header-logo>
<a href=https://omarghader.github.io/>
<img src=https://omarghader.github.io/img/logo.png alt>
<span></span>
</a>
</div>
<span class=floating-header-divider>&mdash;</span>
<div class=floating-header-title>HAProxy LetsEncrypt Docker Tutorial: Create and Renew HTTPs Certificates for free</div>
<div class=floating-header-share>
<div class=floating-header-share-label>Share this<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 15.5V4a1.5 1.5.0 113 0v4.5h2a1 1 0 011 1h2a1 1 0 011 1H18a1.5 1.5.0 011.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2.0 011.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
</div>
<a class=floating-header-share-tw href="https://twitter.com/share?text=HAProxy%20LetsEncrypt%20Docker%20Tutorial%3a%20Create%20and%20Renew%20HTTPs%20Certificates%20for%20free&url=https%3a%2f%2fomarghader.github.io%2fhaproxy-letsencrypt-docker-certbot-certificates%2f" onclick="return window.open(this.href,'share-twitter','width=550,height=235'),!1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088.0 01-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015.0 01-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25.0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688.0 5.063-.875 7.188-2.5-1.25.0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5.0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673.0 01-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228.0 01-1.875-2c-.5-.875-.688-1.813-.688-2.75.0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579.0 011.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48.0 003.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
<a class=floating-header-share-fb href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fomarghader.github.io%2fhaproxy-letsencrypt-docker-certbot-certificates%2f" onclick="return window.open(this.href,'share-facebook','width=580,height=296'),!1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86.0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
</div>
<progress class=progress value=0>
<div class=progress-container>
<span class=progress-bar></span>
</div>
</progress>
</div>
<footer class="site-footer outer">
<div class="site-footer-content inner">
<section class=copyright style=line-height:1.3em>
<a href=https://omarghader.github.io/>omarghader</a> <br>
</section>
<nav class=site-footer-nav>
<a href=https://omarghader.github.io/>Latest Posts</a>
<a href=https://github.com/omarghader target=_blank rel=noopener>Github</a>
</nav>
</div>
</footer>
</div>
<script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script type=text/javascript src=//code.jquery.com/jquery-3.2.1.min.js></script>
<script type=text/javascript src=https://omarghader.github.io/js/jquery.fitvids.js></script>
<script>hljs.initHighlightingOnLoad()</script>
<script>var _gaq=[['_setAccount','UA-66637295-1'],['_trackPageview']];(function(a,b){var c=a.createElement(b),d=a.getElementsByTagName(b)[0];c.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js',d.parentNode.insertBefore(c,d)})(document,'script')</script>
<script>$(document).ready(function(){var j=$(".post-full-content"),g,d,e,b,f,c,a;j.fitVids(),g=document.querySelector('progress'),d=document.querySelector('.floating-header'),e=document.querySelector('.post-full-title'),b=window.scrollY,f=window.innerHeight,c=$(document).height(),a=!1;function k(){b=window.scrollY,h()}function l(){f=window.innerHeight,c=$(document).height(),h()}function h(){a||requestAnimationFrame(i),a=!0}function i(){var h=e.getBoundingClientRect().top+window.scrollY,i=e.offsetHeight+35,j=c-f;b>=h+i?d.classList.add('floating-active'):d.classList.remove('floating-active'),g.setAttribute('max',j),g.setAttribute('value',b),a=!1}window.addEventListener('scroll',k,{passive:!0}),window.addEventListener('resize',l,!1),i()})</script>
</body></html>