<!doctype html><html lang=en-us><head><meta http-equiv=content-type content="text/html" charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/omarghader.github.io\/prometheus-labels-relabeling-clean-metrics-guide\/"},"articleSection":"post","headline":"Using Labels and Relabeling in Prometheus for Clean, Scalable Metrics","name":"Using Labels and Relabeling in Prometheus for Clean, Scalable Metrics","description":"Learn how to use Prometheus labels and relabeling rules to organize, filter, and manage your metrics for a cleaner, more scalable monitoring setup.","inLanguage":"en-US","author":{"@type":"Person","name":"Omar Ghader"},"creator":{"@type":"Person","name":"Omar Ghader"},"publisher":{"@type":"Organization","name":"Omar Ghader","logo":{"@type":"ImageObject","url":"https:\/\/omarghader.github.io\/img/logo.png"}},"accountablePerson":{"@type":"Person","name":"Omar Ghader"},"copyrightHolder":{"@type":"Person","name":"Omar Ghader"},"copyrightYear":"2025","datePublished":"2025-10-14T00:00:00Z","dateModified":"2025-10-14T00:00:00Z","url":"https:\/\/omarghader.github.io\/prometheus-labels-relabeling-clean-metrics-guide\/","wordCount":"1647","image":"https:\/\/omarghader.github.io\/img/logo.png","keywords":["prometheus","monitoring","observability","devops","metrics","labels","relabeling",""]}</script><script>window.addEventListener("load",function(){var b=window._mtm=window._mtm||[],a;b.push({'mtm.startTime':(new Date).getTime(),event:'mtm.Start'}),a=document.createElement('script'),a.async=!0,a.src="https://omarghader.com/matomo/js/container_JgixlzJl.js",document.head.appendChild(a)})</script><title>Using Labels and Relabeling in Prometheus for Clean, Scalable Metrics &#183;</title><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://omarghader.github.io/favicon.ico><link rel=canonical href=https://omarghader.github.io/prometheus-labels-relabeling-clean-metrics-guide/><meta name=description content="Learn how to use Prometheus labels and relabeling rules to organize, filter, and manage your metrics for a cleaner, more scalable monitoring setup."><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Labels and Relabeling in Prometheus for Clean, Scalable Metrics"><meta name=twitter:description content="Learn how to use Prometheus labels and relabeling rules to organize, filter, and manage your metrics for a cleaner, more scalable monitoring setup."><meta name=twitter:url content="https://omarghader.github.io/prometheus-labels-relabeling-clean-metrics-guide/"><meta name=twitter:site content="@"><meta property="og:site_name" content><meta property="og:title" content="Using Labels and Relabeling in Prometheus for Clean, Scalable Metrics &#183; Omar Ghader"><meta property="og:url" content="https://omarghader.github.io/prometheus-labels-relabeling-clean-metrics-guide/"><meta property="og:type" content="article"><meta property="og:description" content="Learn how to use Prometheus labels and relabeling rules to organize, filter, and manage your metrics for a cleaner, more scalable monitoring setup."><meta property="article:published_time" content="2025-10-14T00:00:00Z"><meta property="article:tag" content="prometheus"><meta property="article:tag" content="monitoring"><meta property="article:tag" content="observability"><meta property="article:tag" content="devops"><meta property="article:tag" content="metrics"><meta property="article:tag" content="labels"><meta property="article:tag" content="relabeling"><meta property="og:image" content="https://omarghader.github.io/img/blog-cover.jpg"><meta name=generator content="Hugo 0.85.0"><link rel=stylesheet type=text/css href=https://omarghader.github.io/built/screen.css><link rel=stylesheet type=text/css href=https://omarghader.github.io/css/casper-two.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css><link rel=stylesheet href=https://omarghader.github.io/css/custom.css></head><body class=post-template><div class=site-wrapper><header class="site-header outer"><div class=inner><nav class=site-nav><div class=site-nav-left><a class=site-nav-logo href=#><img src=https://omarghader.github.io/img/logo.png alt="Omar Ghader"></a><ul class=nav role=menu><li role=menuitem><a href=https://omarghader.github.io/ target>Home</a></li><li role=menuitem><a href=https://omarghader.github.io/about target>About</a></li><li role=menuitem><a href=https://www.linkedin.com/in/marc-ghader/ target=_blank>Contact</a></li><li role=menuitem><a href=https://eepurl.com/h6jxnr target=_blank>Newsletter</a></li></ul></div><div class=site-nav-right><div class=social-links><a class=social-link href=https://github.com/omarghader target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a></div></div></nav></div></header><main id=site-main class="site-main outer" role=main><div class=inner><article class="post-full post"><header class=post-full-header><section class=post-full-meta><time class=post-full-meta-date datetime=2025-10-14>14 October 2025</time>
<span class=date-divider>/</span> <a href=https://omarghader.github.io/tags/prometheus/>#prometheus</a>&nbsp;<a href=https://omarghader.github.io/tags/monitoring/>#monitoring</a>&nbsp;</section><h1 class=post-full-title>Using Labels and Relabeling in Prometheus for Clean, Scalable Metrics</h1></header><figure class=post-full-image style=background-image:url(https://omarghader.github.io/defimg/5.jpg)></figure><section class=post-full-content><div class=kg-card-markdown><p>I’ll admit it: the first time I looked at a raw Prometheus metrics endpoint, I felt a bit overwhelmed. It was like staring at a tangled ball of yarn, with metric names and labels sprawling in every direction. I was collecting thousands of time series, but finding the specific signal in the noise felt nearly impossible.</p><p>That’s when I truly understood the power of <strong>labels and relabeling in Prometheus</strong>. They aren&rsquo;t just decorative tags; they&rsquo;re the fundamental tools for organizing your metrics universe. Getting them right transforms your monitoring from a chaotic mess into a clean, queryable, and scalable system.</p><p>In this guide, I&rsquo;ll walk you through how I learned to wield labels and relabeling rules effectively, turning my Prometheus instance from a data hoarder into a well-organized observability powerhouse.</p><h2 id=what-youll-need>What You&rsquo;ll Need</h2><p>Before we dive into the configuration, let&rsquo;s make sure you have the basics covered. You don&rsquo;t need much to follow along, just:</p><ul><li><strong>A Running Prometheus Server:</strong> This could be on a local machine, a VM, or in a container. I&rsquo;m running mine in a Docker container for easy experimentation.</li><li><strong>A Few Sample Applications or Exporters:</strong> To have something to scrape. The <a href=https://github.com/prometheus/node_exporter>Node Exporter</a> is a classic choice for system metrics, but any application exposing a <code>/metrics</code> endpoint will work.</li><li><strong>A Text Editor:</strong> For editing your <code>prometheus.yml</code> file. I&rsquo;m a fan of VS Code, but use whatever you&rsquo;re comfortable with.</li><li><strong>Basic YAML Knowledge:</strong> Prometheus configuration is YAML-based, so knowing how indentation and lists work is key.</li></ul><h2 id=understanding-the-core-concepts-labels-vs-relabeling>Understanding the Core Concepts: Labels vs. Relabeling</h2><p>Let&rsquo;s clear up the terminology first, as I found this confusing in the beginning.</p><ul><li><strong>Labels:</strong> These are key-value pairs attached to a time series. Think of them like tags or attributes. For example, a metric <code>http_requests_total</code> might have labels like <code>method="POST"</code>, <code>handler="/api/users"</code>, and <code>status_code="200"</code>. They are the <em>output</em>—the final form of your metric that you query in PromQL.</li><li><strong>Relabeling:</strong> This is the <em>process</em> of manipulating these labels <em>before</em> they become part of the final time series. It happens during service discovery, scraping, and even when sending alerts. Relabeling is your chance to add, modify, drop, or filter metrics based on their labels.</li></ul><p>The magic happens in the <code>relabel_configs</code> section of your scrape jobs. I like to visualize it as a filter and enrichment pipeline for your metrics data.</p><h2 id=step-1-laying-the-groundwork-with-static-labels>Step 1: Laying the Groundwork with Static Labels</h2><p>The simplest way to add labels is statically in your <code>prometheus.yml</code>. This is perfect for adding context that applies to an entire job.</p><p>Let&rsquo;s look at a basic scrape configuration. Open your <code>prometheus.yml</code> file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># prometheus.yml</span>

<span style=color:#f92672>global</span>:
  <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>15s</span>

<span style=color:#f92672>scrape_configs</span>:
  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;node_exporter&#39;</span>
    <span style=color:#f92672>static_configs</span>:
      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;localhost:9100&#39;</span>]
    <span style=color:#75715e># These labels are added to every time series scraped by this job</span>
    <span style=color:#f92672>labels</span>:
      <span style=color:#f92672>region</span>: <span style=color:#e6db74>&#39;home-lab&#39;</span>
      <span style=color:#f92672>environment</span>: <span style=color:#e6db74>&#39;development&#39;</span>
      <span style=color:#f92672>job</span>: <span style=color:#e6db74>&#39;node&#39;</span>  <span style=color:#75715e># Overrides the job_name label</span>
</code></pre></div><p>In this example, every single metric coming from the Node Exporter will now have the labels <code>region="home-lab"</code>, <code>environment="development"</code>, and <code>job="node"</code>. This is incredibly useful for grouping and filtering metrics in Grafana. For instance, you can easily write a query like <code>up{environment="development"}</code> to check the status of all your dev instances.</p><div class="alert alert-info"><strong>Pro Tip:</strong> While you can use the `job` label, be mindful that many service discovery mechanisms and the `honor_labels` setting can affect it. Being explicit is often safer.</div><h2 id=step-2-dynamic-labeling-with-relabeling-rules>Step 2: Dynamic Labeling with Relabeling Rules</h2><p>Static labels are great, but the real power comes from dynamic <strong>relabeling in Prometheus</strong>. This is where you can create labels based on information from the scrape target itself.</p><h3 id=example-1-extracting-environment-from-a-hostname>Example 1: Extracting Environment from a Hostname</h3><p>Imagine your instances have hostnames like <code>web-server-prod-01</code> and <code>db-server-staging-02</code>. You can tear this apart and create meaningful labels.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>scrape_configs</span>:
  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;node_exporter_by_hostname&#39;</span>
    <span style=color:#f92672>static_configs</span>:
      - <span style=color:#f92672>targets</span>:
        - <span style=color:#e6db74>&#39;web-server-prod-01:9100&#39;</span>
        - <span style=color:#e6db74>&#39;db-server-staging-02:9100&#39;</span>
    <span style=color:#f92672>relabel_configs</span>:
      <span style=color:#75715e># Use a regex to extract parts of the instance (hostname:port)</span>
      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__address__]</span>
        <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;([^:-]+)-(prod|staging|dev)-([^:-]+)&#39;</span>
        <span style=color:#f92672>target_label</span>: <span style=color:#e6db74>&#39;service&#39;</span>
        <span style=color:#f92672>replacement</span>: <span style=color:#e6db74>&#39;$1&#39;</span> <span style=color:#75715e># The first group, e.g., &#39;web-server&#39; or &#39;db-server&#39;</span>
      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__address__]</span>
        <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;([^:-]+)-(prod|staging|dev)-([^:-]+)&#39;</span>
        <span style=color:#f92672>target_label</span>: <span style=color:#e6db74>&#39;environment&#39;</span>
        <span style=color:#f92672>replacement</span>: <span style=color:#e6db74>&#39;$2&#39;</span> <span style=color:#75715e># The second group, e.g., &#39;prod&#39; or &#39;staging&#39;</span>
      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__address__]</span>
        <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;([^:-]+)-(prod|staging|dev)-([^:-]+)&#39;</span>
        <span style=color:#f92672>target_label</span>: <span style=color:#e6db74>&#39;instance_id&#39;</span>
        <span style=color:#f92672>replacement</span>: <span style=color:#e6db74>&#39;$3&#39;</span> <span style=color:#75715e># The third group, e.g., &#39;01&#39; or &#39;02&#39;</span>
</code></pre></div><p>Now, instead of a messy <code>instance</code> label with the full hostname and port, you have clean, separate labels for <code>service</code>, <code>environment</code>, and <code>instance_id</code>. Your Grafana dashboards just got a whole lot more powerful.</p><h3 id=example-2-filtering-metrics-with-metric_relabel_configs>Example 2: Filtering Metrics with <code>metric_relabel_configs</code></h3><p>Sometimes, you don&rsquo;t want <em>all</em> the metrics. Some might be too noisy, expensive to store, or just irrelevant. This is where <code>metric_relabel_configs</code> comes in. It applies relabeling rules <em>after</em> the scrape, on the metrics themselves.</p><p>Let&rsquo;s say the Node Exporter&rsquo;s <code>node_network_receive_bytes_total</code> metric has multiple time series per network interface, and you only care about <code>eth0</code> and <code>wlan0</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>scrape_configs</span>:
  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;node_exporter_filtered&#39;</span>
    <span style=color:#f92672>static_configs</span>:
      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#39;localhost:9100&#39;</span>]
    <span style=color:#f92672>metric_relabel_configs</span>:
      <span style=color:#75715e># Drop all network receive metrics that are NOT for eth0 or wlan0</span>
      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__name__, device]</span>
        <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;node_network_receive_bytes_total;(eth0|wlan0)&#39;</span>
        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>keep</span>
      <span style=color:#75715e># Alternatively, to DROP specific interfaces (like the docker bridge)</span>
      <span style=color:#75715e># - source_labels: [device]</span>
      <span style=color:#75715e>#   regex: &#39;docker0&#39;</span>
      <span style=color:#75715e>#   action: drop</span>
</code></pre></div><p>The <code>action: keep</code> tells Prometheus to only keep the time series where the combination of the metric name (<code>__name__</code>) and the <code>device</code> label matches either <code>eth0</code> or <code>wlan0</code>. Everything else is discarded, saving storage and reducing clutter.</p><h2 id=step-3-advanced-relabeling-with-service-discovery>Step 3: Advanced Relabeling with Service Discovery</h2><p>This is where relabeling becomes absolutely essential. When using service discovery (like file-based SD, Consul, or Kubernetes), your targets come with a set of metadata labels. Relabeling is how you map that metadata into useful metric labels.</p><h3 id=file-based-service-discovery-example>File-Based Service Discovery Example</h3><p>Create a file called <code>targets.json</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>[
  {
    <span style=color:#f92672>&#34;targets&#34;</span>: [ <span style=color:#e6db74>&#34;192.168.1.10:9100&#34;</span> ],
    <span style=color:#f92672>&#34;labels&#34;</span>: {
      <span style=color:#f92672>&#34;environment&#34;</span>: <span style=color:#e6db74>&#34;production&#34;</span>,
      <span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;webserver&#34;</span>,
      <span style=color:#f92672>&#34;dc&#34;</span>: <span style=color:#e6db74>&#34;home-dc-1&#34;</span>
    }
  },
  {
    <span style=color:#f92672>&#34;targets&#34;</span>: [ <span style=color:#e6db74>&#34;192.168.1.11:9100&#34;</span> ],
    <span style=color:#f92672>&#34;labels&#34;</span>: {
      <span style=color:#f92672>&#34;environment&#34;</span>: <span style=color:#e6db74>&#34;staging&#34;</span>,
      <span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;database&#34;</span>,
      <span style=color:#f92672>&#34;dc&#34;</span>: <span style=color:#e6db74>&#34;home-dc-1&#34;</span>
    }
  }
]
</code></pre></div><p>Now, configure Prometheus to use this file and employ relabeling to use these labels.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>scrape_configs</span>:
  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#39;file_sd_nodes&#39;</span>
    <span style=color:#f92672>file_sd_configs</span>:
      - <span style=color:#f92672>files</span>:
        - <span style=color:#e6db74>&#39;targets.json&#39;</span>
        <span style=color:#f92672>refresh_interval</span>: <span style=color:#ae81ff>5m</span> <span style=color:#75715e># Reload the file every 5 minutes</span>
    <span style=color:#f92672>relabel_configs</span>:
      <span style=color:#75715e># The labels from the JSON file are automatically available as source_labels.</span>
      <span style=color:#75715e># We can directly map them to the final metric labels.</span>
      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__meta_sd_environment]</span>
        <span style=color:#f92672>target_label</span>: <span style=color:#e6db74>&#39;environment&#39;</span>
      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__meta_sd_role]</span>
        <span style=color:#f92672>target_label</span>: <span style=color:#e6db74>&#39;role&#39;</span>
      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__meta_sd_dc]</span>
        <span style=color:#f92672>target_label</span>: <span style=color:#e6db74>&#39;datacenter&#39;</span>
      <span style=color:#75715e># A common pattern: use the instance IP from the target for the &#39;instance&#39; label</span>
      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__address__]</span>
        <span style=color:#f92672>target_label</span>: <span style=color:#ae81ff>instance</span>
        <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;(.+):.+&#39;</span>
        <span style=color:#f92672>replacement</span>: <span style=color:#e6db74>&#39;${1}&#39;</span>
</code></pre></div><h2 id=troubleshooting-and-common-pitfalls>Troubleshooting and Common Pitfalls</h2><p>My journey with relabeling wasn&rsquo;t without its bumps. Here are the main issues I ran into and how to solve them.</p><ol><li><p><strong>&ldquo;My labels aren&rsquo;t showing up!"</strong> This is the most common problem. Use the Prometheus UI&rsquo;s <strong>Status > Targets</strong> page. It shows you the discovered labels <em>before</em> and <em>after</em> relabeling. This is your best friend for debugging. Look for the <code>Before relabeling</code> and <code>After relabeling</code> sections for your target.</p></li><li><p><strong>Regex Catastrophes.</strong> Prometheus uses <a href=https://github.com/google/re2/wiki/Syntax>RE2 syntax</a>. It doesn&rsquo;t support all the fancy features of PCRE. Test your regexes in a tool like <a href=https://regex101.com/>Regex101</a> with the &ldquo;Golang&rdquo; flavor selected.</p></li><li><p><strong>Dropping the Wrong Metrics.</strong> Be very careful with <code>action: drop</code>. It&rsquo;s easy to be too aggressive and drop metrics you need. Always test new drop rules in a staging environment first and monitor your scraped metric counts.</p></li><li><p><strong>Cardinality Explosion.</strong> This is the big one. <strong>Never, ever create labels from unbounded sets of values.</strong> A classic mistake is putting a user ID, session ID, or entire log line into a label. Each unique combination of label values creates a new time series. A few hundred is fine; a few million will kill your Prometheus server. Stick to low-cardinality values like status codes, environment names, endpoint names, and server roles.</p></li></ol><h2 id=taking-it-further>Taking It Further</h2><p>Once you&rsquo;re comfortable with the basics, you can explore more advanced patterns:</p><ul><li><strong>Cross-Service Label Unification:</strong> Standardize label names (e.g., always use <code>env</code> instead of a mix of <code>env</code>, <code>environment</code>, <code>deployment</code>) across all your jobs and exporters. This makes Grafana dashboards and alerting rules much simpler.</li><li><strong>Alert Relabeling:</strong> Use <code>alert_relabel_configs</code> in your <code>alertmanager.yml</code> to add context to your alerts before they are sent to channels like Slack or PagerDuty, similar to how I detailed in my guide on <a href=https://omarghader.github.io/grafana-alerting-custom-message/>Grafana Alerting with Custom Messages</a>.</li><li><strong>Remote Write Relabeling:</strong> If you&rsquo;re sending data to a long-term storage like Grafana Mimir or Thanos, you can use relabeling there to further filter or aggregate data, optimizing costs.</li></ul><h2 id=wrapping-up>Wrapping Up</h2><p>Mastering <strong>labels and relabeling in Prometheus</strong> was a game-changer for my monitoring setup. It transformed a sprawling collection of data points into a well-organized, queryable, and actionable system. Start simple with static labels, then gradually introduce dynamic relabeling to filter and enrich your metrics. Always keep an eye on cardinality, and use the Prometheus UI to debug.</p><p>Happy monitoring!</p><hr><h3 id=faq>FAQ</h3><p><strong>Q: What is the difference between <code>relabel_configs</code> and <code>metric_relabel_configs</code>?</strong>
<strong>A:</strong> <code>relabel_configs</code> happens <em>before</em> the scrape, acting on the target metadata. It&rsquo;s used for deciding what to scrape and adding labels from service discovery. <code>metric_relabel_configs</code> happens <em>after</em> the scrape, acting on the metrics that were returned. It&rsquo;s used for filtering out unwanted metrics or modifying labels on the metrics themselves.</p><p><strong>Q: How can I prevent high cardinality in my Prometheus labels?</strong>
<strong>A:</strong> Strictly avoid using any user-specific IDs, email addresses, or other unbounded, unique values as label values. Limit labels to known, finite sets of values like environment (<code>prod</code>, <code>staging</code>), HTTP method (<code>GET</code>, <code>POST</code>), status code (<code>200</code>, <code>404</code>, <code>500</code>), or predefined resource names.</p><p><strong>Q: Can I modify the metric name itself with relabeling?</strong>
<strong>A:</strong> Yes, you can! The metric name is stored in the special <code>__name__</code> label. You can create a relabeling rule with <code>target_label: __name__</code> to rename a metric. For example, you could standardize metric names coming from different exporters.</p><p><strong>Q: Where is the best place to see the effect of my relabeling rules?</strong>
<strong>A:</strong> The Prometheus web UI under <strong>Status > Targets</strong> is the definitive source. It shows you the complete list of labels for each target both before and after your <code>relabel_configs</code> have been applied. For <code>metric_relabel_configs</code>, you can query the metrics directly or check the <code>/metrics</code> endpoint of your target.</p></div><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=auto data-full-width-responsive=true data-ad-client=ca-pub-2980078129213070 data-ad-slot></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></section><footer class=post-full-footer><section class=author-card><img class=author-profile-image src=https://omarghader.github.io/img/me/omar.jpg alt=Author><section class=author-card-content><h4 class=author-card-name><a href=https://omarghader.github.io/>Omar Ghader</a></h4><p>Monitoring, DevOps and SmartHome</p></section></section></footer></article></div></main><aside class="read-next outer"><div class=inner><div class=read-next-feed><article class=read-next-card style=background-image:url(https://omarghader.github.io/img/blog-cover.jpg)><header class=read-next-card-header><small class=read-next-card-header-sitetitle>&mdash; Omar Ghader &mdash;</small><h3 class=read-next-card-header-title><a href=https://omarghader.github.io/tags/prometheus/>#prometheus</a></h3></header><div class=read-next-divider><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg></div><div class=read-next-card-content><ul><li><a href=https://omarghader.github.io/vmalert-setup/>Vmalert: Revamp your Prometheus alert with microservices</a></li><li><a href=https://omarghader.github.io/visualizing-time-series-data-grafana-transform-threshold-tools/>Visualizing Time Series Data Using Grafana’s Transform and Threshold Tools</a></li><li><a href=https://omarghader.github.io/prometheus-vs-victoriametrics-comparison-performance-storage-query-language/>Prometheus vs VictoriaMetrics: Performance, Storage, and Query Language Compared</a></li><li><a href=https://omarghader.github.io/introduction-to-docker/>Introduction to Docker</a></li></ul></div><footer class=read-next-card-footer><a href=https://omarghader.github.io/tags/prometheus/>See all related posts →</a></footer></article><article class="post-card post"><a class=post-card-image-link href=https://omarghader.github.io/automate-air-purifier-esp32-home-assistant-aqi/><div class=post-card-image style=background-image:url(https://omarghader.github.io/defimg/2.jpg)></div></a><div class=post-card-content><a class=post-card-content-link href=https://omarghader.github.io/automate-air-purifier-esp32-home-assistant-aqi/><header class=post-card-header><span class=post-card-tags>#home assistant
#esp32
#air quality
#automation
#esphome
#aqi
#smart home</span><h2 class=post-card-title>Control and Automate Air Purifier with ESP32 and Home Assistant Air Quality Index</h2></header><section class=post-card-excerpt><p>Learn how to read the Home Assistant Air Quality Index and automatically control an air purifier using an ESP32 relay for a smarter, healthier home.</p></section></a><footer class=post-card-meta><img class=author-profile-image src=https://omarghader.github.io/img/me/omar.jpg alt=Author>
<span class=post-card-author><a href=https://omarghader.github.io/>Omar Ghader</a></span></footer></div></article><article class="post-card post"><a class=post-card-image-link href=https://omarghader.github.io/esp32-ultrasonic-room-occupancy-tracker/><div class=post-card-image style=background-image:url(https://omarghader.github.io/defimg/1.jpg)></div></a><div class=post-card-content><a class=post-card-content-link href=https://omarghader.github.io/esp32-ultrasonic-room-occupancy-tracker/><header class=post-card-header><span class=post-card-tags>#esp32
#home automation
#room occupancy
#ultrasonic sensor
#esphome
#mqtt
#smart home
#diy</span><h2 class=post-card-title>Build a Room Occupancy Tracker with ESP32 and Ultrasonic Sensors</h2></header><section class=post-card-excerpt><p>Step-by-step guide to building a DIY room occupancy tracker using an ESP32 and HC-SR04 ultrasonic sensor for smart home automation.</p></section></a><footer class=post-card-meta><img class=author-profile-image src=https://omarghader.github.io/img/me/omar.jpg alt=Author>
<span class=post-card-author><a href=https://omarghader.github.io/>Omar Ghader</a></span></footer></div></article></div></div></aside><div class=floating-header><div class=floating-header-logo><a href=https://omarghader.github.io/><img src=https://omarghader.github.io/img/logo.png alt>
<span></span></a></div><span class=floating-header-divider>&mdash;</span><div class=floating-header-title>Using Labels and Relabeling in Prometheus for Clean, Scalable Metrics</div><div class=floating-header-share><div class=floating-header-share-label>Share this<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 15.5V4a1.5 1.5.0 113 0v4.5h2a1 1 0 011 1h2a1 1 0 011 1H18a1.5 1.5.0 011.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2.0 011.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg></div><a class=floating-header-share-tw href="https://twitter.com/share?text=Using%20Labels%20and%20Relabeling%20in%20Prometheus%20for%20Clean%2c%20Scalable%20Metrics&url=https%3a%2f%2fomarghader.github.io%2fprometheus-labels-relabeling-clean-metrics-guide%2f" onclick="return window.open(this.href,'share-twitter','width=550,height=235'),!1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088.0 01-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015.0 01-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25.0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688.0 5.063-.875 7.188-2.5-1.25.0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5.0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673.0 01-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228.0 01-1.875-2c-.5-.875-.688-1.813-.688-2.75.0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579.0 011.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48.0 003.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a><a class=floating-header-share-fb href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fomarghader.github.io%2fprometheus-labels-relabeling-clean-metrics-guide%2f" onclick="return window.open(this.href,'share-facebook','width=580,height=296'),!1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86.0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg></a></div><progress class=progress value=0><div class=progress-container><span class=progress-bar></span></div></progress></div><footer class="site-footer outer"><div class="site-footer-content inner"><section class=copyright style=line-height:1.3em><a href=https://omarghader.github.io/>omarghader</a><br></section><nav class=site-footer-nav><a href=https://omarghader.github.io/>Latest Posts</a>
<a href=https://github.com/omarghader target=_blank rel=noopener>Github</a></nav></div></footer></div><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script type=text/javascript src=//code.jquery.com/jquery-3.2.1.min.js></script><script type=text/javascript src=https://omarghader.github.io/js/jquery.fitvids.js></script><script>hljs.initHighlightingOnLoad()</script><script>window.addEventListener("load",function(){var a=document.createElement("script");a.src="https://www.googletagmanager.com/gtag/js?id=G-SMB08YT14H",a.async=!0,document.head.appendChild(a),a.onload=function(){window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date),a("config","G-SMB08YT14H")}})</script><script>$(document).ready(function(){var j=$(".post-full-content"),g,d,e,b,f,c,a;j.fitVids(),g=document.querySelector('progress'),d=document.querySelector('.floating-header'),e=document.querySelector('.post-full-title'),b=window.scrollY,f=window.innerHeight,c=$(document).height(),a=!1;function k(){b=window.scrollY,h()}function l(){f=window.innerHeight,c=$(document).height(),h()}function h(){a||requestAnimationFrame(i),a=!0}function i(){var h=e.getBoundingClientRect().top+window.scrollY,i=e.offsetHeight+35,j=c-f;b>=h+i?d.classList.add('floating-active'):d.classList.remove('floating-active'),g.setAttribute('max',j),g.setAttribute('value',b),a=!1}window.addEventListener('scroll',k,{passive:!0}),window.addEventListener('resize',l,!1),i()})</script></body></html>